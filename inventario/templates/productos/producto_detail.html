{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Detalle de Producto{% endblock %}
{% block header %}<i class="fas fa-box-open"></i> {{ producto.nombre }}{% endblock %}

{% block extra_buttons %}
<div class="d-flex gap-2">
  <a href="{% url 'productos:producto_update' producto.pk %}" class="btn btn-outline-primary">
    <i class="fas fa-edit"></i> Editar
  </a>
  <a href="{% url 'productos:producto_delete' producto.pk %}" class="btn btn-outline-danger">
    <i class="fas fa-trash-alt"></i> Eliminar
  </a>
  <a href="{% url 'productos:producto_list' %}" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left"></i> Volver
  </a>
</div>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-center">
  <div class="card mb-4 shadow-sm" style="width: 100%; max-width: 700px; background-color: #F8F6F3;">
    <div class="card-body">
      <h5 class="card-title text-vinoteca">Informaci√≥n del producto</h5>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Nombre:</strong> {{ producto.nombre }}</li>
        <li class="list-group-item"><strong>Descripci√≥n:</strong> {{ producto.descripcion }}</li>
        <li class="list-group-item"><strong>Precio:</strong> ${{ producto.precio }}</li>
        <li class="list-group-item">
          <strong>Stock actual:</strong>
          {% if producto.stock < producto.stock_minimo %}
            <span class="badge" style="background-color:#B22222; color:#fff;">{{ producto.stock }} (Bajo)</span>
          {% else %}
            <span class="badge" style="background-color:#6B8E23; color:#fff;">{{ producto.stock }}</span>
          {% endif %}
        </li>
        <li class="list-group-item"><strong>Stock m√≠nimo:</strong> {{ producto.stock_minimo }}</li>
        <li class="list-group-item"><strong>SKU:</strong> {{ producto.sku }}</li>
      </ul>
    </div>
  </div>
</div>

<hr>

<h5 class="mt-4">üì¶ √öltimos movimientos de stock</h5>
<div class="table-responsive">
  <table class="table table-sm table-striped">
    <thead style="background-color:#4B1E1E; color:#F8F6F3;">
      <tr>
        <th>Fecha</th>
        <th>Tipo</th>
        <th>Cantidad</th>
        <th>Motivo</th>
        <th>Usuario</th>
      </tr>
    </thead>
    <tbody>
      {% for movimiento in movimientos %}
      <tr class="{% if movimiento.tipo == 'salida' %}table-danger{% else %}table-success{% endif %}">
        <td>{{ movimiento.fecha|date:"d/m/Y H:i" }}</td>
        <td>{{ movimiento.get_tipo_display }}</td>
        <td>{{ movimiento.cantidad }}</td>
        <td>{{ movimiento.motivo }}</td>
        <td>{{ movimiento.usuario }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center">No hay movimientos registrados.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<hr>

<h5 class="mt-4">‚öñÔ∏è Ajuste de stock</h5>
<div class="d-flex justify-content-center">
  <div class="card shadow-sm" style="width: 100%; max-width: 600px; background-color: #F8F6F3;">
    <div class="card-body">
      <form method="post" action="{% url 'productos:ajustar_stock' producto.pk %}">
        {% csrf_token %}
        {{ form_ajuste|crispy }}
        <div class="mt-3 d-flex justify-content-end">
          <button type="submit" class="btn btn-vinoteca">
            <i class="fas fa-balance-scale"></i> Ajustar Stock
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
